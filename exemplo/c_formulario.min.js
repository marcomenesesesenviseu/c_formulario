window.jQuery||console.error("A libraria jQuery está em falta."),"object"!=typeof bootstrap&&console.error("A libraria bootstrap está em falta."),"object"!=typeof b5toast&&console.error("A libraria b5toast está em falta.");class comparacoes{constructor(o,e,s,i){this.expressao=o,this.objeto=e,this.propriedade=s,this.valor=i}}class mensagens{constructor(o,e,s){this.ficheiro=o,this.existe=e,this.tempo_de_espera=s}}class formulario_validacoes{constructor(o,e,s,i=!1){this.num=this.length>0?this[this.length-1].num++:1,this.id=o,this.comparacao=e,this.texto_erro=s,this.mostra_resultado=i}}class formulario_erros{constructor(o,e){this.num=this.length>0?this[this.length-1].num++:1,this.funcao=o,this.mensagem_erro=e}}class formulario_objetos{constructor(o,e,s,i,t=!1){this.num=o,this.id=e,this.valor=s,this.escondido=i,this.testado=t}}class limitadores{static get inicial(){return"«"}static get final(){return"»"}static get separador(){return"."}static get includes_inicial(){return"('"}static get includes_final(){return"')"}}class constantes{static get classe_esconde(){return"esconde_c_formulario"}static get classe_geral_valido(){return"is-valid"}static get classe_geral_invalido(){return"is-invalid"}static get classe_obj_valido(){return"objeto_valido_c_formulario"}static get classe_obj_invalido(){return"objeto_invalido_c_formulario"}static get prefixo_obj_erro(){return"erro_"}}class c_formulario{constructor(o){this.erros=[],this.mensagens=new mensagens("c_formulario.json",this.#o(),this.#o()?this.#e("tempo_de_espera"):3500),this.id="#"+o,this.nome=o,this.formulario=$(this.id),this.formulario.encontrarobjetos="input,textarea,select",this.formulario.filtro="*",this.formulario.elementos=[],this.formulario.num_elementos=this.formulario.elementos.length,this.formulario.objetos=[],this.formulario.is("form")?this.#s():(this.Adiciona_Erros(["Construtor","O objeto não é um formulário"]),console.log(this.erros[0].funcao+": "+this.erros[0].mensagem_erro)),this.validacoes=[],this.validacoes.elemento_error=void 0}#o(){return void 0!==$.ajax({type:"GET",url:this.ficheiro_mensagens+"ddd",async:!1,dataType:"json",data:{},success:function(o){return JSON.stringify(o)},error:function(){return-1}}).responseJSON}#e(o,e=-1){let s,i="-9999";if(!this.mensagens.existe)return console.error("O ficheiro json de mensagens não existe: "+this.mensagens.ficheiro),-2;s=$.ajax({type:"GET",url:this.mensagens.ficheiro,async:!1,dataType:"json",data:{},success:function(o){return JSON.stringify(o)},error:function(o,e,s){return console.error("Erro no acesso ao ficheiro de mesnagens: "+this.messagens.ficheiro),-1}});try{i=s.responseJSON[o]}catch(e){return console.error("A informação "+o+" não se encontra no ficheiro "+this.mensagens.ficheiro),-1}return e>-1&&(i=s.responseJSON[o][e]),console.log(i),i}#i(o,e,s=!1){if("undefined"==typeof b5toast)return console.error("O objeto b5toast (ficheiro JS) não existe. Efetue o seu download, para as mensagens funcionem!"),!1;valor=this.#e(o);let i=null;for(let o=0;o<valor.length;o++)if(valor[o][0]==e){i=valor[o];break}if(null!=i){let o=this.#e("tipos_mensagens",i[1]);b5toast.show(o[2],o[3]+i[2]+": "+i[3],s?o[1]:"",this.mensagens.tempo_de_espera)}else b5toast.show("danger","Variavel não encontrada: "+o,"ERRO",this.mensagens.tempo_de_espera)}#t(o=void 0){return $("#"+o)}Adiciona_Erros(o=[]){if(0===this.erros.length){if(2!=o.length)return;this.erros.push(new formulario_erros("Construtor","O objeto não é um formulário"))}}Apaga_Erros(o){for(let e=0;e<this.erros.length;e++)this.erros[e].funcao.toUpperCase()===o.toUpperCase()&&this.erros[e].splice(e,1)}ObterElementos(){0===this.erros.length&&(this.formulario.elementos=this.formulario.find(this.formulario.encontrarobjetos).filter(this.formulario.filtro),this.formulario.num_elementos=this.formulario.elementos.length)}#s(){if(0===this.erros.length){let o=0;this.ObterElementos(),this.formulario.vetores=new formulario_objetos([],[],[],[]);for(let e=0;e<this.formulario.num_elementos;e++)if(o=$(this.formulario.elementos[e]).hasAttr("formulario-numobj")?parseInt($(this.formulario.elementos[e]).attr("formulario-numobj")):e,""!==this.formulario.elementos[e].id){let s=[];s=this.formulario.elementos[e].id.includes("chk")?[o,this.formulario.elementos[e].id,this.formulario.elementos[e].checked?1:0,$(this.formulario.elementos[e]).hasClass(constantes.classe_esconde)]:[o,this.formulario.elementos[e].id,this.formulario.elementos[e].value,$(this.formulario.elementos[e]).hasClass(constantes.classe_esconde)],this.formulario.objetos.push(new formulario_objetos(...s)),this.formulario.vetores.num.push(s[0]),this.formulario.vetores.id.push(s[1]),this.formulario.vetores.valor.push(s[2]),this.formulario.vetores.escondido.push(s[3])}}}#r(o=[]){return 0===this.erros.length?-1==this.#a(o[0])?(console.log("TESTA_ENTRADA_DADOS: O objeto não existe no formulário: "+o[0]),!1):"string"!=typeof o[1]?(console.log("TESTA_ENTRADA_DADOS: O objeto não é texto. "+o[1]),!1):"string"!=typeof o[2]?(console.log("TESTA_ENTRADA_DADOS: O objeto não é texto para o erro."+o[2]),!1):4!=o.length||"boolean"==typeof o[3]||(console.log("TESTA_ENTRADA_DADOS: O objeto não é um valor booleano. "+o[3]),!1):(console.log("TESTA_ENTRADA_DADOS: Existem erros no formulário"),!1)}Adiciona_Validacoes(o=[]){if(0===this.erros.length)return[3,4].includes(o.length)&&this.#r(o)?(this.validacoes.push(new formulario_validacoes(...o)),!0):(console.log("ADICIONA_VALIDACOES: Deve introduzir 3 ou 4 dados como vetor ([id ou formulario-numobj do objeto, string de comparação, string com a mensagem de erro]): \n"+o.length+" -- "+JSON.stringify(o)),!1);console.log("ADICIONA_VALIDACOES: O objeto definido não é um formulário")}#l(o,e){return e.indexOf(o)}#n(o=void 0){let e=-1;return o.includes("?")?(e=this.formulario.vetores.id.filter((e=>e.includes(o.replace("?","")))).length-1,e>-1&&(e=this.#l(this.formulario.vetores.id.filter((e=>e.includes(o.replace("?",""))))[0],this.formulario.vetores.id))):(e=this.#l(o,this.formulario.vetores.num),-1==e&&(e=this.#l(o,this.formulario.vetores.id))),e}#a(o=void 0){if(void 0===o)return console.error(`VERIFICA_ELEMENTO_EXISTE: = O ID do objeto ${o} é indefinido!`),-1;if("int"!=typeof o&&"string"!=typeof o)return console.error(`VERIFICA_ELEMENTO_EXISTE: O número ou o id do objeto ${o} do tipo errado!`),-1;let e=this.#n(o);return-1==e?(console.error(`VERIFICA_ELEMENTO_EXISTE: O objeto ${o} não existe no formulário!`),-1):e}#c(o=void 0){let e=[];if(0==this.validacoes.length)return console.error("VERIFICA_ELEMENTO_VALIDACAO_EXISTE: Não existem validações para testar!"),-1;for(let s=0;s<this.validacoes.length;++s)null!=o?$(this).id==o&&e.push(s):e.push(s);return 0==e.length?(console.error(`VERIFICA_ELEMENTO_VALIDACAO_EXISTE: O objeto ${o} não existe nas validações!`),-1):e}#d(o,e,s){if(o.includes(e)&&o.includes(s)){let i=o.indexOf(e)+e.length,t=o.indexOf(s,i);return o.substring(i,t)}return console.error(`DEVOLVE_TEXTO_ENTRE_LIMITADORES: O objeto ${num_ou_nome_objeto} não contém os limitadores « ou »!`),-1}#u(o){let e=o,s=[],i=0;for(;-1!=e.indexOf(limitadores.inicial,i);){let o=[0,0];o[0]=e.indexOf(limitadores.inicial,i),o[1]=e.indexOf(limitadores.final,i)+1,i=o[1];let t,r=e.substr(o[0],o[1]),a=[];r.includes(limitadores.separador)?(a.push(r.split(limitadores.separador)[0].replace(limitadores.inicial,"").replace(limitadores.final,"")),a.push(r.split(limitadores.separador)[1].replace(limitadores.inicial,"").replace(limitadores.final,""))):a.push(r.replace(limitadores.inicial,"").replace(limitadores.final,"")),a[1]=a[1].toLowerCase(),1==a.length||"val"==a[1]||"value"==a[1]?t=$("#"+a[0]).val():"check"==a[1]||"ckecked"==a[1]?t=$("#"+a[0]).is(":checked"):"length"==a[1]||"len"==a[1]?a[0].includes("?")?(a[0]=a[0].replace("?",""),t=$("input[name*='"+a[0]+"']:checked").length):t=$("#"+a[0]).val().length:a[1].toLowerCase().includes("isnumeric")?t=!$.isNumeric($("#"+a[0]).val()):a[1].toLowerCase().includes("includes")?a[1].includes(limitadores.includes_inicial)&&a[1].includes(limitadores.includes_final)?(t=this.#d(a[1],limitadores.includes_inicial,limitadores.includes_final),t=$("#"+a[0]).val().includes(t)):t="ERRO AO AVALIAR A PROPRIEDADE INCLUDES":a[1].toLowerCase().includes("indexof")?a[1].includes(limitadores.includes_inicial)&&a[1].includes(limitadores.includes_final)?(t=this.#d(a[1],limitadores.includes_inicial,limitadores.includes_final),t=$("#"+a[0]).val().indexOf(t)):t="ERRO AO AVALIAR A PROPRIEDADE INDEXOF":t="ERRO DE PROPRIEDADE","string"===(typeof t).toLowerCase()&&(t="'"+t+"'"),s.push(new comparacoes(r,a[0],a[1],t))}for(let o=0;o<s.length;o++)e=e.replace(s[o].expressao,s[o].valor);return e}#_(o=void 0){if(0!==this.erros.length)return console.log(`TESTES_INICIAIS: O objeto ${this.formulario} definido não é um formulário!`),!1;if("int"==typeof o||"string"==typeof o)return console.log(`TESTES_INICIAIS: O objeto ${o} definido não é do tipo correcto (int ou string)!`),!1;if(null!=o){if(-1==this.#a(o))return console.log(`TESTES_INICIAIS: O objeto ${o} definido não existe no formulário!`),!1;if(this.#t(o).hasClass("is-invalid"))return console.log(`TESTES_INICIAIS: O objeto ${o} já está validado com erro!`),!1}return!0}#m(o=void 0,e=void 0,s=!0){if(null==o||!Number.isInteger(o))return console.log(`COLOCAR_ESTADO_CAIXA: Não foi indicado o valor inteiro da posição do objeto, valor: ${o}`),!1;if(null==e||"boolean"!=typeof e)return console.log(`COLOCAR_ESTADO_CAIXA: Não foi indicado o valor booleano do erro do objeto, valor: ${e}`),!1;let i=this.validacoes[o].id.includes("?")?this.validacoes[o].id.replace("?",""):this.validacoes[o].id,t="#"+i,r="#"+constantes.prefixo_obj_erro+i,a=constantes.classe_geral_invalido,l=constantes.classe_geral_valido;$(t).is("input,select,textarea")||(a=constantes.classe_obj_invalido,l=constantes.classe_obj_valido),e?($(t).removeClass(l),$(t).addClass(a),void 0!==$(r)?($(r).removeClass(constantes.classe_esconde),$(r).html(this.validacoes[o].texto_erro),s&&$(t).focus()):console.log(`COLOCAR_ESTADO_CAIXA: O objeto ${t} não tem objeto de erro ${r}`)):($(t).removeClass(a),$(t).addClass(l),void 0===$(r)||$(r).hasClass(constantes.classe_esconde)||$(r).addClass(constantes.classe_esconde))}Testa_Validacoes(num_ou_nome_objeto=void 0,coloca_focus_erro=!0){if(!this.#_(num_ou_nome_objeto))return!1;$.each(this.formulario.objetos,(function(){this.testado=!1})),this.#s();let posicoes_validacoes_testar=this.#c(num_ou_nome_objeto),existe_erros=!1;for(let i=0;i<=posicoes_validacoes_testar.length-1;++i){let pos_objeto=this.#n(this.validacoes[i].id);if(-1==pos_objeto)continue;if(this.formulario.objetos[pos_objeto].testado||this.formulario.objetos[pos_objeto].escondido)continue;let txtcomparacao=this.#u(this.validacoes[i].comparacao);if(""==txtcomparacao){console.log("TESTA_VALIDACOES: ("+this.validacoes[i].id+") - Expressão de comparação vazia: "+txtcomparacao);continue}let resultado=-1;try{resultado=eval?.(txtcomparacao),this.validacoes[i].mostra_resultado&&alert(`Comparação: ${txtcomparacao} - Resultado: ${resultado}`)}catch(o){}"boolean"==typeof resultado?(this.#m(i,resultado,coloca_focus_erro),resultado&&(this.formulario.objetos[pos_objeto].testado=!0,existe_erros||(existe_erros=!0,coloca_focus_erro=!1))):console.error("TESTA_VALIDACOES: ("+num_ou_nome_objeto+") - Erro ao executar a expressão: "+txtcomparacao)}return existe_erros}Limpar_Validacoes(o=!0){this.#h(),o?this.formulario.trigger("reset"):this.formulario.limpar_espacos()}#h(o=void 0){if(null==o||!Number.isInteger(o))return console.log(`LIMPAR_CAIXA_ERRO: Não foi indicado o valor inteiro da posição do objeto, valor: ${o}`),!1;if(void 0===num_ou_nome_objeto)for(let o=0;o<this.validacoes.length;++o){let e=this.validacoes[o].id.includes("?")?this.validacoes[o].id.replace("?",""):this.validacoes[o].id,s="#"+e,i="#"+constantes.prefixo_obj_erro+e,t=constantes.classe_geral_invalido,r=constantes.classe_geral_valido;$(s).is("input,select,textarea")||(t=constantes.classe_obj_invalido,r=constantes.classe_obj_valido),null!=s&&(s.hasClass(r)&&s.removeClass(r),s.hasClass(t)&&s.removeClass(t)),null!=i&&(i.hasClass(constantes.classe_esconde)||i.addClass(constantes.classe_esconde))}else{let e=this.validacoes[o].id.includes("?")?this.validacoes[o].id.replace("?",""):this.validacoes[o].id,s=$("#"+e),i=$("#"+constantes.prefixo_obj_erro+e);null!=s&&(s.hasClass(classe_valido)&&s.removeClass(classe_valido),s.hasClass(classe_erro)&&s.removeClass(classe_erro)),null!=i&&(i.hasClass(constantes.classe_esconde)||i.addClass(constantes.classe_esconde))}}}